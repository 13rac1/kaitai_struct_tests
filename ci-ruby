#!/bin/sh

. ./config

mkdir -p "$TEST_OUT_DIR/ruby"
rspec -I compiled/ruby -I "$RUBY_RUNTIME_DIR" -f json --out "$TEST_OUT_DIR/ruby/test-output-ruby.json" spec/ruby

# In Travis, we'll be running different (probably old and obsolete) version of Ruby at this point,
# so we'll need to reset it back to modern one, as `aggregate` framework relies on some modern
# features.
if [ -n "$TRAVIS" ]; then
	echo 'Running in Travis, need to switch Ruby back to modern default one'
	rvm use default
fi

aggregate/convert_to_json ruby "$TEST_OUT_DIR/ruby/test-output-ruby.json" "$TEST_OUT_DIR/ruby/ci.json"
